# Тестовое задание на стажировку Biocad 2023 golang backend 

## Тестовое задние
Необходимо написать сервис на языке golang который будет реализовывать следующие функции:
* [x] брать конфиги(host,port,password и т.д.) для соединения с БД (бд на выбор) а так же адрес директории
* [x] периодически осматривать директорию на наличие новых не обработанных еще файлов (.tsv) (вероятно держать в базе список уже обработанных) (см. лист "Исходные данные")
* [x] обработку файлов ставить в очередь
* [x] обработка файла - нужно распарсить .tsv и положить в соответствующую структуру (формат файла статичный, поля/количество не меняется)
* [x] данные из файла поместить в БД
* [X] после обработки файла и записи в БД нужно сформировать файл(rtf,* ,pdf на выбор) с названием из поля *unit_guid* в входном файле, с данными по этому *unit_guid*
* [x] ошибки парсинга (например не соответсвие файла) - тоже записывать в БД и файл
* [x] выходные файлы размещать в отдельной директории
* [x] сделать API-интерфейс который позволит получать из БД данные с пагинацией (page/limit) для получения данных по *unit_guid*

Примечание: *unit_guid* - это некий уникальный идентификатор устройства, в файле содержатся строки описывающие множество устройств

## Описание 

## Особенности реализации


```

├── README.md
├── config
│   ├── config.go
│   └── configFile
│       ├── devMain.yaml
│       ├── devPDFConfig.yaml
│       ├── devdbConfig.yaml
│       └── index.html
├── db
│   ├── dbImplement
│   │   └── mongoDb.go
│   └── dbInterface
│       └── db.go
├── go.mod
├── go.sum
├── main.go
└── src
    ├── dir
    │   └── dir.go
    ├── message
    │   └── message.go
    ├── pdfGenerator
    │   ├── font
    │   │   └── Arial Unicode MS.ttf
    │   ├── pdf.go
    │   └── pdf_test.go
    ├── processing
    │   └── processing.go
    └── webServer
        ├── handler.go
        └── server.go
```

В данной программе реализовано 9 модулей: `main`, `config`, `dbImplement`, `dbInterface`, `dir`, `message`, `processing`, `pdfGenerator`, `webServer`

В модуле main:
- инициализируется группа ожидания горутин, соединение с базой данных, очередь работ.
- распознавание флагов запуска программы
- считывание файла конфигурации
- запуск процессов:
    - проверки наличия не обработанных файлов
    - обработки файлов
    - http сервера

В пакете `dir` содержатся функции проверки директории и файлов
В пакете `processing` содержатся функции обработки файлов.
В пакете `dbInterface` содержится интерфейс `DBI`
В пакете `dbImplement` содержится реализация методов работы с MongoDB
В пакете `message` содержится объявление класса message, являющегося моделью сообщения некоторого устройства.

В данном проекте используется база данных MongoDB так как умение работать с этой библиотекой является одним из требований к вакансии стажера.
Для сокрытия реализации методов работы с БД был использован интерфейс `DBI` в пакете *dbInterface*
Следующие параметры подключения к БД указываются в файле конфигурации *dev.yaml*: 
- DBImplement: "mongodb"
- host: "mongodb://localhost"
- port: ":27017"
- database: "dev"
- collection: "trainers"
- file_collection: "file"

Для работы с конфигурационными файлами используется библиотека `Viper`

Файлы в рабочей директории проверяются на условия:
- это не папка
- имя этого файла не имеет префикса "processed_", что означает, что файл обработан
- имя этого файла не имеет префикса "in_procss_", что означает, что файл уже добавлен в очередь на обработку

После обработки каждого файла генерируются PDF файлы со списков всех сообщений от устройства, чьи сообщения были в данном файле. Директория, в которой генерируются данные файлы указана в файле конфигурации.

После парсинга файла каждое сообщение отправляется в dev.guid. 
Статус обработки каждого файла отправляется в dev.file как структура с полями 
`{filename string, status string } `


Выполнена реализация API интерфейса в виде html страницы и в виде json ответа.
html: `http://localhost:8000/index`
json:  `http://localhost:8000/json?id=01749246-960c-5832-b2aa-ed2b4da5e137&page=2`



Для запуска программы необходимо установить некоторые библиотеки
- "github.com/spf13/viper"
 - "github.com/jung-kurt/gofpdf"
- "go.mongodb.org/mongo-driver"

И установить MongoDB.
Необходимо указать верные данные для подключения в файле `devdbConfig.yaml` 