# Тестовое задание на стажировку Biocad 2023 golang backend 

## Тестовое задние
Необходимо написать сервис на языке golang который будет реализовывать следующие функции:
* [x] брать конфиги(host,port,password и т.д.) для соединения с БД (бд на выбор) а так же адрес директории
* [x] периодически осматривать директорию на наличие новых не обработанных еще файлов (.tsv) (вероятно держать в базе список уже обработанных) (см. лист "Исходные данные")
* [x] обработку файлов ставить в очередь
* [x] обработка файла - нужно распарсить .tsv и положить в соответствующую структуру (формат файла статичный, поля/количество не меняется)
* [x] данные из файла поместить в БД
* [ ] после обработки файла и записи в БД нужно сформировать файл(rtf,* ,pdf на выбор) с названием из поля *unit_guid* в входном файле, с данными по этому *unit_guid*
* [ ] ошибки парсинга (например не соответсвие файла) - тоже записывать в БД и файл
* [ ] выходные файлы размещать в отдельной директории
* [x] сделать API-интерфейс который позволит получать из БД данные с пагинацией (page/limit) для получения данных по *unit_guid*

Примечание: *unit_guid* - это некий уникальный идентификатор устройства, в файле содержатся строки описывающие множество устройств

## Описание 

## Особенности реализации

```
├── README.md
├── config
│   ├── config.go
│   └── configuration
│       ├── dev.yaml
│       ├── public
│       │   └── index.html
│       └── sample.html
├── db
│   ├── DBImplementation
│   │   └── mongoDB.go
│   └── dbAbstract
│       └── db.go
├── go.mod
├── go.sum
├── main.go
└── src
    ├── dir
    │   └── dir.go
    ├── message
    │   └── message.go
    ├── pdfGenerator
    │   └── pdf.go
    ├── processing
    │   └── processing.go
    └── webServer
        ├── htmlServer
        │   └── webServer.go
        └── jsonServer
   ```


В данной программе реализовано 9 модулей: `main`, `config`, `DBImplementation`, `dbAbstract`, `dir`, `message`, `processing`, `pdfGenerator`, `webServer`

В модуле main:
- инициализируется группа ожидания горутин, соединение с базой данных, очередь работ.
- распознавание флагов запуска программы
- считывание файла конфигурации
- запуск процессов:
    - проверки наличия не обработанных файлов
    - обработки файлов
    - http сервера

В пакете `dir` содержатся функции проверки директории и файлов
В пакете `processing` содержатся функции обработки файлов.
В пакете `dbAbstract` содержится интерфейс `Database`
В пакете `dbAbstract` содержится реализация методов работы с MongoDB
В пакете `message` содержится объявление класса message, являющегося моделью сообщения некоторого устройства.
В пакете `pdfGenerator` содержатся функции создания pdf отчетов


В данном проекте используется база данных MongoDB так как умение работать с этой библиотекой является одним из требований к вакансии стажера.
Для сокрытия реализации методов работы с БД был использован интерфейс `Database` в пакете *db/dbAbstract*
Следующие параметры подключения к БД указываются в файле конфигурации *dev.yaml*: 
- DBImplement: "mongodb"
- host: "mongodb://localhost"
- port: ":27017"
- database: "dev"
- collection: "trainers"
- log_collection: "log"

Для работы с конфигурационными файлами используется библиотека `Viper`

Файы в рабочей директории проверяются на условия:
- это не папка
- это tsv файл
- имя этого файла не имеет префикса "processed_", что означает, что файл обработан
- имя этого файла не имеет префикса "in_procss_", что означает, что файл уже добавлен в очередь на обработку

